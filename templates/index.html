{% extends "base.html" %}
{% block content %}

<main class="max-w-4xl mx-auto px-4 py-12">
    <div class="mb-10 p-4 bg-white border border-dashed border-gray-300 rounded-lg text-center text-gray-400 italic text-[10px] uppercase tracking-widest">
        –†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫ (AdSense Top)
    </div>

    <section class="bg-white rounded-[40px] shadow-xl p-8 md:p-12 border border-gray-50">
        <textarea id="text" class="w-full h-64 p-6 bg-gray-50 border border-gray-100 rounded-[30px] outline-none focus:ring-4 focus:ring-blue-100 text-lg resize-none transition-all font-medium" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏ (–¥–æ 2000 –∑–Ω–∞–∫–æ–≤)..."></textarea>
        
        <div class="mt-8">
            <label class="text-[10px] font-black text-gray-400 uppercase mb-4 block tracking-[0.2em] ml-2 text-center md:text-left">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –≥–æ–ª–æ—Å–∞</label>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <label class="cursor-pointer">
                    <input type="radio" name="voice_mode" value="natural" class="peer hidden" checked>
                    <div class="p-4 border-2 border-gray-100 rounded-2xl text-center peer-checked:border-blue-600 peer-checked:bg-blue-50 transition-all hover:bg-gray-50">
                        <span class="block text-xl mb-1">üçÉ</span>
                        <span class="block font-bold text-sm">–¢–∞–±–∏“ì–∏</span>
                        <span class="text-[10px] text-gray-400">–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π</span>
                    </div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="voice_mode" value="slow" class="peer hidden">
                    <div class="p-4 border-2 border-gray-100 rounded-2xl text-center peer-checked:border-blue-600 peer-checked:bg-blue-50 transition-all hover:bg-gray-50">
                        <span class="block text-xl mb-1">üê¢</span>
                        <span class="block font-bold text-sm">–ê–Ω—ã“õ</span>
                        <span class="text-[10px] text-gray-400">–ú–µ–¥–ª–µ–Ω–Ω–æ</span>
                    </div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="voice_mode" value="fast" class="peer hidden">
                    <div class="p-4 border-2 border-gray-100 rounded-2xl text-center peer-checked:border-blue-600 peer-checked:bg-blue-50 transition-all hover:bg-gray-50">
                        <span class="block text-xl mb-1">‚ö°</span>
                        <span class="block font-bold text-sm">–ñ—ã–ª–¥–∞–º</span>
                        <span class="text-[10px] text-gray-400">–ë—ã—Å—Ç—Ä–æ</span>
                    </div>
                </label>
            </div>
        </div>

        <div class="mt-10 flex flex-col md:flex-row gap-6 items-end justify-between border-t border-gray-100 pt-8">
            <div class="w-full md:w-1/2">
                <label class="text-[10px] font-black text-gray-400 uppercase mb-3 block tracking-[0.2em] ml-2">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–ª–æ—Å –∏ —è–∑—ã–∫</label>
                <select id="voiceSelect" class="w-full p-4 bg-white border border-gray-200 rounded-2xl outline-none shadow-sm font-bold text-gray-700 cursor-pointer focus:border-blue-500 transition-all">
                    <optgroup label="–°–ù–ì / CIS">
                        <option value="kk-KZ-DauletNeural" selected>“ö–∞–∑–∞“õ—à–∞ ‚Äî –î–∞—É–ª–µ—Ç</option>
                        <option value="ru-RU-DmitryNeural">–†—É—Å—Å–∫–∏–π ‚Äî –î–º–∏—Ç—Ä–∏–π</option>
                        <option value="ru-RU-SvetlanaNeural">–†—É—Å—Å–∫–∏–π ‚Äî –°–≤–µ—Ç–ª–∞–Ω–∞</option>
                    </optgroup>
                    </select>
            </div>
            <button onclick="generateAudio()" id="mainBtn" class="w-full md:w-auto px-16 py-5 bg-blue-600 text-white font-black rounded-[20px] hover:bg-blue-700 shadow-xl shadow-blue-200 transition-all active:scale-95 uppercase tracking-widest text-xs">
                –û–∑–≤—É—á–∏—Ç—å —Å–µ–π—á–∞—Å
            </button>
        </div>

        <div id="previewContainer" class="hidden mt-10 p-6 bg-blue-50 rounded-[30px] border-2 border-blue-100 animate-fade-in">
            <div class="text-center">
                <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-4">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ</p>
                <audio id="audioPlayer" controls class="w-full mb-6 accent-blue-600 shadow-sm"></audio>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="goToDownload()" class="flex-1 bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 transition-all shadow-lg shadow-blue-100">
                        üì• –°–∫–∞—á–∞—Ç—å MP3
                    </button>
                    <button onclick="resetPreview()" class="flex-1 bg-white text-gray-500 font-bold py-4 rounded-xl border border-gray-200 hover:bg-gray-50 transition-all">
                        üîÑ –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section class="mt-16 p-10 bg-white rounded-[40px] border border-gray-100 text-center shadow-sm">
        <h3 class="text-2xl font-black mb-2 uppercase tracking-tighter">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç ‚òï</h3>
        </section>

    <div class="mt-20 p-6 bg-white border border-dashed border-gray-200 rounded-3xl text-center text-gray-400 text-xs italic uppercase tracking-[0.2em]">
        –†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫ (AdSense Bottom)
    </div>
</main>

<script>
let currentFileName = "";

async function generateAudio() {
    const btn = document.getElementById('mainBtn');
    const textInput = document.getElementById('text');
    const voiceSelect = document.getElementById('voiceSelect');
    const mode = document.querySelector('input[name="voice_mode"]:checked').value;
    
    if(!textInput.value.trim()) return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç");

    btn.disabled = true;
    btn.innerHTML = `<span class="animate-pulse tracking-widest">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º...</span>`;

    try {
        const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                text: textInput.value,
                voice: voiceSelect.value,
                mode: mode
            })
        });

        const data = await response.json();
        
        if(data.audio_url) {
            currentFileName = data.file_name;
            const player = document.getElementById('audioPlayer');
            player.src = data.audio_url;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–µ—Ä –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–µ–º—É
            document.getElementById('previewContainer').classList.remove('hidden');
            document.getElementById('previewContainer').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            btn.innerText = "–û–±–Ω–æ–≤–∏—Ç—å –æ–∑–≤—É—á–∫—É";
        }
    } catch (e) {
        alert("–û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
    } finally {
        btn.disabled = false;
    }
}

function goToDownload() {
    if(currentFileName) {
        window.location.href = `/download-page?file=${currentFileName}`;
    }
}

function resetPreview() {
    document.getElementById('previewContainer').classList.add('hidden');
    document.getElementById('text').value = "";
    document.getElementById('mainBtn').innerText = "–û–∑–≤—É—á–∏—Ç—å —Å–µ–π—á–∞—Å";
    currentFileName = "";
}
</script>

<style>
    .animate-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
{% endblock %}






