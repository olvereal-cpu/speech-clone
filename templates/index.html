{% extends "base.html" %}

{% block description %}–û–∑–≤—É—á—å—Ç–µ —Ç–µ–∫—Å—Ç –æ–Ω–ª–∞–π–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ —Å –ø–æ–º–æ—â—å—é –ò–ò. –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –≥–æ–ª–æ—Å–∞ (–î–º–∏—Ç—Ä–∏–π, –°–≤–µ—Ç–ª–∞–Ω–∞ –∏ –¥—Ä.), –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —É–¥–∞—Ä–µ–Ω–∏–π. –°–∫–∞—á–∏–≤–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ SpeechClone.{% endblock %}

{% block content %}
<main class="max-w-4xl mx-auto px-4 py-12">
    <div class="mb-10 p-4 bg-white border border-dashed border-gray-200 rounded-[30px] text-center min-h-[90px] flex items-center justify-center overflow-hidden">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2792779022553212"
             data-ad-slot="–¢–£–¢_ID_–í–ï–†–•–ù–ï–ì–û_–ë–õ–û–ö–ê"
             data-ad-format="horizontal"
             data-full-width-responsive="true"></ins>
    </div>

    <section class="bg-white rounded-[40px] shadow-xl p-8 md:p-12 border border-gray-50 animate-fade-in">
        <textarea id="text" maxlength="2000" class="w-full h-64 p-6 bg-gray-50 border border-gray-100 rounded-[30px] outline-none focus:ring-4 focus:ring-blue-100 text-lg resize-none transition-all font-medium" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏ (–¥–æ 2000 –∑–Ω–∞–∫–æ–≤)..."></textarea>
        
        <div class="text-right pr-6 -mt-10 relative z-10">
            <span id="charCount" class="text-[10px] font-black text-gray-400 bg-white/90 px-3 py-1.5 rounded-xl shadow-sm border border-gray-100 uppercase tracking-widest">0 / 2000</span>
        </div>

        <div class="mt-5 ml-4 flex items-center gap-2">
            <span class="flex h-2 w-2 rounded-full bg-blue-500 animate-pulse"></span>
            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                –°–æ–≤–µ—Ç: —Å—Ç–∞–≤—å—Ç–µ <span class="text-blue-600">+</span> –ø–µ—Ä–µ–¥ –≥–ª–∞—Å–Ω–æ–π –¥–ª—è —É–¥–∞—Ä–µ–Ω–∏—è (–Ω–∞–ø—Ä. –∑+–∞–º–æ–∫)
            </p>
        </div>
        
        <div class="mt-8 flex flex-col md:flex-row gap-6 items-end justify-between">
            <div class="w-full md:w-1/2">
                <label class="text-[10px] font-black text-gray-400 uppercase mb-3 block tracking-[0.2em] ml-2">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–ª–æ—Å –∏ —è–∑—ã–∫</label>
                <select id="voiceSelect" class="w-full p-4 bg-white border border-gray-200 rounded-2xl outline-none shadow-sm font-bold text-gray-700 cursor-pointer focus:border-blue-500 transition-all mb-4">
                    <optgroup label="–°–ù–ì / CIS">
                        <option value="ru-RU-DmitryNeural">–†—É—Å—Å–∫–∏–π ‚Äî –î–º–∏—Ç—Ä–∏–π (–ú—É–∂—Å–∫–æ–π)</option>
                        <option value="ru-RU-SvetlanaNeural">–†—É—Å—Å–∫–∏–π ‚Äî –°–≤–µ—Ç–ª–∞–Ω–∞ (–ñ–µ–Ω—Å–∫–∏–π)</option>
                        <option value="uk-UA-OstapNeural">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ ‚Äî –û—Å—Ç–∞–ø</option>
                        <option value="kk-KZ-DauletNeural">“ö–∞–∑–∞“õ—à–∞ ‚Äî –î–∞—É–ª–µ—Ç</option>
                    </optgroup>
                    <optgroup label="English">
                        <option value="en-US-AvaNeural">English (US) ‚Äî Ava</option>
                        <option value="en-US-GuyNeural">English (US) ‚Äî Guy</option>
                        <option value="en-GB-SoniaNeural">English (UK) ‚Äî Sonia</option>
                    </optgroup>
                    <optgroup label="Europe & Asia">
                        <option value="de-DE-KatjaNeural">Deutsch (Germany)</option>
                        <option value="fr-FR-DeniseNeural">Fran√ßais (France)</option>
                        <option value="zh-CN-YunxiNeural">Chinese</option>
                        <option value="ja-JP-NanamiNeural">Japanese</option>
                    </optgroup>
                </select>

                <div class="grid grid-cols-3 gap-2">
                    <label class="cursor-pointer">
                        <input type="radio" name="mode" value="natural" class="peer hidden" checked>
                        <div class="peer-checked:bg-blue-600 peer-checked:text-white bg-gray-100 text-gray-500 py-3 rounded-xl text-center text-[10px] font-black uppercase transition-all">Natural</div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="mode" value="slow" class="peer hidden">
                        <div class="peer-checked:bg-blue-600 peer-checked:text-white bg-gray-100 text-gray-500 py-3 rounded-xl text-center text-[10px] font-black uppercase transition-all">Slow</div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="mode" value="fast" class="peer hidden">
                        <div class="peer-checked:bg-blue-600 peer-checked:text-white bg-gray-100 text-gray-500 py-3 rounded-xl text-center text-[10px] font-black uppercase transition-all">Fast</div>
                    </label>
                </div>
            </div>

            <button id="mainBtn" onclick="generateAudio()" class="w-full md:w-auto px-12 py-5 bg-blue-600 text-white rounded-[25px] font-black uppercase text-xs tracking-widest hover:bg-black transition-all shadow-lg shadow-blue-100">
                –û–∑–≤—É—á–∏—Ç—å
            </button>
        </div>

        <div id="resultSection" class="hidden mt-10 p-6 bg-blue-50 rounded-[30px] border border-blue-100 animate-fade-in">
            <div class="flex flex-col items-center gap-6">
                <audio id="audioPlayer" controls class="w-full"></audio>
                
                <div class="w-full py-2 bg-white/50 rounded-2xl flex items-center justify-center min-h-[100px]">
                     <ins class="adsbygoogle"
                          style="display:block"
                          data-ad-client="ca-pub-2792779022553212"
                          data-ad-slot="–¢–£–¢_ID_–ü–û–î_–ü–õ–ï–ï–†–û–ú"
                          data-ad-format="auto"
                          data-full-width-responsive="true"></ins>
                </div>

                <button id="downloadBtn" class="w-full md:w-auto whitespace-nowrap px-8 py-4 bg-black text-white rounded-2xl font-black uppercase text-[10px] tracking-widest text-center hover:bg-blue-600 transition-all">
                    –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª ‚Üí
                </button>
            </div>
        </div>
    </section>

    <section class="mt-20 px-4">
        <h2 class="text-2xl font-black text-gray-900 uppercase tracking-tighter mb-8 italic">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
        <div class="grid gap-4">
            <details class="group bg-white rounded-[30px] border border-gray-100 shadow-sm overflow-hidden transition-all">
                <summary class="flex justify-between items-center p-6 cursor-pointer list-none font-bold text-gray-700">
                    –ö–∞–∫ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–¥–∞—Ä–µ–Ω–∏–µ?
                    <span class="transition group-open:rotate-180">‚ñº</span>
                </summary>
                <div class="px-6 pb-6 text-gray-500 text-sm leading-relaxed">
                    –ï—Å–ª–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –æ—à–∏–±–∞–µ—Ç—Å—è –≤ —É–¥–∞—Ä–µ–Ω–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–º–≤–æ–ª <span class="text-blue-600 font-bold">+</span> –ø–µ—Ä–µ–¥ —É–¥–∞—Ä–Ω–æ–π –≥–ª–∞—Å–Ω–æ–π.
                    <br><br>–ù–∞–ø—Ä–∏–º–µ—Ä: <br>
                    ‚Äî <b>—Ö–ª+–æ–ø–∫–æ–≤–∞—è</b> —Ç–∫–∞–Ω—å <br>
                    ‚Äî –≥—Ä–æ–º–∫–∏–µ <b>—Ö–ª–æ–ø–∫+–∏</b>
                </div>
            </details>

            <details class="group bg-white rounded-[30px] border border-gray-100 shadow-sm overflow-hidden transition-all" open>
                <summary class="flex justify-between items-center p-6 cursor-pointer list-none font-bold text-gray-700">
                    –ö–∞–∫ —Å–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ?
                    <span class="transition group-open:rotate-180">‚ñº</span>
                </summary>
                <p class="px-6 pb-6 text-gray-500 text-sm leading-relaxed">
                    –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª". –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –≤–∞—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–≥—Ä—É–∑–∫–∏, –≥–¥–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3.
                </p>
            </details>
        </div>
    </section>

    <section class="mt-20" id="support">
        <div class="bg-gray-900 rounded-[50px] p-10 md:p-16 text-center text-white relative overflow-hidden shadow-2xl shadow-blue-200">
            <div class="relative z-10">
                <h2 class="text-3xl md:text-5xl font-black mb-6 leading-none tracking-tighter italic">–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ <span class="text-blue-500">Open Source</span>.</h2>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                    <a href="https://paypal.me/velial39@gmail.com" class="bg-blue-600 px-4 py-5 rounded-2xl font-black uppercase text-[9px] tracking-widest hover:scale-105 transition-all flex flex-col items-center gap-2">
                        <span>PayPal</span>
                        <span class="opacity-60 font-normal italic">Global</span>
                    </a>
                    <a href="https://yoomoney.ru/to/–¢–£–¢_–¢–í–û–ô_–ù–û–ú–ï–†" class="bg-[#8b3ffd] px-4 py-5 rounded-2xl font-black uppercase text-[9px] tracking-widest hover:scale-105 transition-all flex flex-col items-center gap-2">
                        <span>–ÆMoney</span>
                        <span class="opacity-90 font-normal italic">–†–§ üá∑üá∫</span>
                    </a>
                    <a href="https://kaspi.kz/pay/–¢–£–¢_ID" class="bg-red-600 px-4 py-5 rounded-2xl font-black uppercase text-[9px] tracking-widest hover:scale-105 transition-all flex flex-col items-center gap-2">
                        <span>Kaspi</span>
                        <span class="opacity-90 font-normal italic">KZ üá∞üáø</span>
                    </a>
                    <a href="https://t.me/speechclonebot?start=donate" class="bg-yellow-500 px-4 py-5 rounded-2xl font-black uppercase text-[9px] tracking-widest hover:scale-105 transition-all flex flex-col items-center gap-2 text-black">
                        <span>Stars ‚≠êÔ∏è</span>
                        <span class="opacity-90 font-normal italic">Telegram</span>
                    </a>
                </div>
            </div>
        </div>
    </section>
</main>

<div id="chat-widget" class="fixed bottom-6 right-6 z-[100] font-sans">
    <button id="chat-toggle" onclick="toggleChat(event)" class="w-14 h-14 bg-blue-600 rounded-full shadow-2xl flex items-center justify-center text-2xl hover:bg-black transition-all hover:scale-110 active:scale-95 text-white">
        üí¨
    </button>
    
    <div id="chat-window" class="hidden absolute bottom-20 right-0 w-[320px] bg-white rounded-[30px] shadow-2xl border border-gray-100 flex flex-col overflow-hidden animate-fade-in">
        <div class="bg-gray-900 p-5 text-white flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-lg">ü§ñ</div>
            <div>
                <p class="font-black text-[10px] uppercase tracking-widest">SpeechClone Assistant</p>
                <p class="text-[10px] text-blue-400 font-bold italic">–û–Ω–ª–∞–π–Ω</p>
            </div>
        </div>
        
        <div id="chat-messages" class="h-80 overflow-y-auto p-4 space-y-4 bg-gray-50 flex flex-col"></div>

        <div class="p-4 bg-white border-t border-gray-100 flex gap-2">
            <input type="text" id="chat-input" placeholder="–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å..." class="flex-1 bg-gray-50 border border-gray-100 rounded-2xl px-4 py-3 text-sm outline-none focus:border-blue-500 font-medium">
            <button id="chat-send" onclick="handleChat()" class="bg-blue-600 text-white w-10 h-10 rounded-xl flex items-center justify-center hover:bg-black transition-all">
                üöÄ
            </button>
        </div>
    </div>
</div>

<script>
// –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∫–ª–∞–º—ã
try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) {}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–±—Ä–æ—Å–∫–∏ —Ç–µ–∫—Å—Ç–∞
function copyToVoice(text) {
    const textInput = document.getElementById('text');
    if (textInput) {
        textInput.value = text;
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ –∏–∑ —á–∞—Ç–∞
        const charCount = document.getElementById('charCount');
        if (charCount) charCount.innerText = `${text.length} / 2000`;
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
        textInput.focus();
        textInput.classList.add('ring-4', 'ring-blue-100');
        setTimeout(() => textInput.classList.remove('ring-4', 'ring-blue-100'), 2000);
    }
}

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–∞—Ç–∞
function toggleChat(e) {
    if (e) e.preventDefault();
    const chatWindow = document.getElementById('chat-window');
    const chatInput = document.getElementById('chat-input');
    if (chatWindow) {
        chatWindow.classList.toggle('hidden');
        if (!chatWindow.classList.contains('hidden')) {
            chatInput.focus();
        }
    }
}

function addMessage(text, isBot = false) {
    const chatMessages = document.getElementById('chat-messages');
    if (!chatMessages) return;

    const msg = document.createElement('div');
    msg.className = isBot ? "self-start bg-white p-3 rounded-2xl rounded-bl-none shadow-sm border border-gray-100 max-w-[85%] text-sm font-medium text-gray-700 mb-2" 
                           : "self-end bg-blue-600 p-3 rounded-2xl rounded-br-none text-white max-w-[85%] text-sm font-medium shadow-md shadow-blue-100 mb-2";
    
    const safeText = text.replace(/'/g, "\\'").replace(/"/g, '&quot;');

    if (isBot) {
        msg.innerHTML = `
            <div>${text}</div>
            <button onclick="copyToVoice('${safeText}')" class="mt-2 text-[9px] font-black uppercase text-blue-600 hover:text-black transition-all block">
                ‚ö° –û–∑–≤—É—á–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç
            </button>
        `;
    } else {
        msg.innerHTML = `
            <div>${text}</div>
            <button onclick="copyToVoice('${safeText}')" class="mt-2 text-[9px] font-black uppercase text-blue-100 hover:text-white transition-all block text-right w-full">
                ‚ö° –û–∑–≤—É—á–∏—Ç—å –º–æ–π —Ç–µ–∫—Å—Ç
            </button>
        `;
    }
    
    chatMessages.appendChild(msg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

async function handleChat() {
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');
    const text = chatInput.value.trim();
    if (!text) return;

    addMessage(text, false);
    chatInput.value = '';

    const typing = document.createElement('div');
    typing.className = "self-start text-[10px] text-gray-400 italic ml-2 mb-2";
    typing.innerText = "–ü–µ—á–∞—Ç–∞–µ—Ç...";
    chatMessages.appendChild(typing);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    try {
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
        });
        const data = await response.json();
        typing.remove();
        addMessage(data.reply || "–ò–∑–≤–∏–Ω–∏, –±—Ä–æ, —è –∑–∞–¥—É–º–∞–ª—Å—è. –ü–æ–≤—Ç–æ—Ä–∏—à—å?", true);
    } catch (e) {
        if(typing) typing.remove();
        addMessage("–ë—Ä–æ, —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–ª–µ–≥ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ! üîå", true);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    // –õ–û–ì–ò–ö–ê –°–ß–ï–¢–ß–ò–ö–ê –°–ò–ú–í–û–õ–û–í
    const textInput = document.getElementById('text');
    const charCount = document.getElementById('charCount');

    if (textInput && charCount) {
        textInput.addEventListener('input', () => {
            const length = textInput.value.length;
            charCount.innerText = `${length} / 2000`;
            
            if (length >= 1900) {
                charCount.classList.remove('text-gray-400');
                charCount.classList.add('text-red-500');
            } else {
                charCount.classList.remove('text-red-500');
                charCount.classList.add('text-gray-400');
            }
        });
    }

    const chatInput = document.getElementById('chat-input');
    if (chatInput) {
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleChat();
            }
        });
    }

    setTimeout(() => {
        const chatMessages = document.getElementById('chat-messages');
        if(chatMessages && chatMessages.children.length === 0) {
            addMessage("–ü—Ä–∏–≤–µ—Ç! üëã –Ø –°–ø–∏—á-–ë—Ä–æ. –ß–µ–º –ø–æ–º–æ—á—å —Å –æ–∑–≤—É—á–∫–æ–π?", true);
        }
    }, 1000);
});

async function generateAudio() {
    const btn = document.getElementById('mainBtn');
    const textInput = document.getElementById('text');
    const voiceSelect = document.getElementById('voiceSelect');
    const modeElement = document.querySelector('input[name="mode"]:checked');
    const resultSection = document.getElementById('resultSection');
    const audioPlayer = document.getElementById('audioPlayer');
    const downloadBtn = document.getElementById('downloadBtn');
    
    if(!textInput.value.trim()) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç");
    const mode = modeElement ? modeElement.value : 'natural';

    btn.disabled = true;
    btn.innerHTML = `<span class="animate-pulse">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º...</span>`;
    resultSection.classList.add('hidden');

    try {
        const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: textInput.value, voice: voiceSelect.value, mode: mode })
        });
        const data = await response.json();
        if(data.audio_url) {
            audioPlayer.src = data.audio_url;
            resultSection.classList.remove('hidden');
            const fileName = data.audio_url.split('/').pop();
            downloadBtn.onclick = () => { window.location.href = `/download-page?file=${fileName}`; };
        }
    } catch (e) {
        alert("–û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ API");
    } finally {
        btn.disabled = false;
        btn.innerText = "–û–∑–≤—É—á–∏—Ç—å";
    }
}
</script>
{% endblock %}



















